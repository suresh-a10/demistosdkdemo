contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
id: ee1185fc-25a5-4048-861b-499bbdc3b4c6
inputs: []
name: pp_dlp_zscaler_playbook
outputs: []
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f63fbb9a-2f3e-4404-818d-9d981a515dd2
      iscommand: false
      name: ""
      version: -1
    taskid: f63fbb9a-2f3e-4404-818d-9d981a515dd2
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 480,
          "y": 65
        }
      }
  "1":
    continueonerrortype: ""
    id: "1"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler sourcetype=zscaler_web NOT action=\"Allowed\"
          NOT dlpengine=\"None\" AND dlpengine=\"DLP*\" \n| stats count(dlpidentifier)
          as Total_Events by dlpengine \n| search dlpengine IN (\"DLP Auth Answers
          Engine\",\"DLP Auth Passwords Engine\",\"DLP Company Confidential Documents
          Engine\",\"DLP Compliance Blacklist Engine\",\"DLP PPC Engine\",\"DLP Passport
          Engine\",\"DLP US Drivers License Engine\",\"DLP US SSN Engine\", \"DLP
          PCI DSS Engine\", \"DLP US Tax ID Engine\", \"DLP CCN Engine\", \"DLP Swift
          Codes Engine\", \"DLP Regex for Hostnames Engine\", \"DLP Regex for Passwords
          Engine\") \n| sort -Total_Events \n| eval result=dlpengine+\": \"+Total_Events
          \n| table result \n| stats values(result) as result"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: a6cce334-93f7-4643-8f05-33243be75c85
      iscommand: false
      name: Splunk query for zscaler policy engine
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: a6cce334-93f7-4643-8f05-33243be75c85
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1390
        }
      }
  "3":
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          Monitoring Alert for Block Policies with ZIR turned on:

          ${slack_message}
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: ca8d2c22-56ba-467a-84d0-40582a22c268
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: ca8d2c22-56ba-467a-84d0-40582a22c268
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1915
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      resolution:
        simple: Auto-closed
      resolutionsummary:
        simple: Auto-closed
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8d352e68-fa23-4afc-8d46-3a5a61d82468
      iscommand: false
      name: Close investigation
      script: pp_CloseInvestigation_v2
      type: regular
      version: -1
    taskid: 8d352e68-fa23-4afc-8d46-3a5a61d82468
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 2440
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: 8915c3cc-0334-418b-8294-0aa932611429
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: 8915c3cc-0334-418b-8294-0aa932611429
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2090
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "13"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: edce041b-5fd2-426e-8638-7359762909c8
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: edce041b-5fd2-426e-8638-7359762909c8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 400
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "8"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler sourcetype=zscaler_web NOT action=\"Allowed\"NOT
          dlpengine=\"None\"AND dlpengine IN (\"DLP Auth Answers Engine\",\"DLP Auth
          Passwords Engine\",\"DLP Company Confidential Documents Engine\",\"DLP Compliance
          Blacklist Engine\",\"DLP PPC Engine\",\"DLP Passport Engine\",\"DLP US Drivers
          License Engine\",\"DLP US Drivers License Engine\",\"DLP US SSN Engine\",
          \"DLP PCI DSS Engine\", \"DLP US Tax ID Engine\", \"DLP CCN Engine\", \"DLP
          Swift Codes Engine\", \"DLP Regex for Hostnames Engine\", \"DLP Regex for
          Passwords Engine\") \n| stats count(dlpidentifier) as Total_Events | head
          1"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: e78ffee9-0713-4873-8f2a-89a19a2f61d8
      iscommand: false
      name: Splunk query for zscaler policy engine (total volume)
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: e78ffee9-0713-4873-8f2a-89a19a2f61d8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 720
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "16"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          -------------------------------------------------------------------------------------

          Total Volume of Blocked Events in Last 24 Hour: ${Splunk.Result.[0].Total_Events}

          -------------------------------------------------------------------------------------
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: a167046b-5677-41a3-818a-5c6de529e20f
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: a167046b-5677-41a3-818a-5c6de529e20f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 895
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "10"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_message
      stringify:
        simple: "true"
      value:
        simple: ${Splunk.Result.result}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 3849cb04-c33b-44a8-896d-be389e91d426
      iscommand: false
      name: Move splunk results to slack_message context data
      script: Set
      type: regular
      version: -1
    taskid: 3849cb04-c33b-44a8-896d-be389e91d426
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1565
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: slack_message
      value:
        complex:
          root: ${slack_message}
          transformers:
          - args:
              regex:
                value:
                  simple: \["
              replaceWith: {}
            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '","'
              replaceWith:
                value:
                  simple: |2+

            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '"\]'
              replaceWith: {}
            operator: replaceMatch
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 468d9ae6-a192-4ed5-859c-660b6f674385
      iscommand: false
      name: Replace characters in slack_message
      script: Set
      type: regular
      version: -1
    taskid: 468d9ae6-a192-4ed5-859c-660b6f674385
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1740
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "6"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_channel_name
      value:
        simple: dlp_alerts_monitoring
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: dd0c5492-673d-4933-8f7a-080f6bb0462f
      iscommand: false
      name: Set slack channel name
      script: Set
      type: regular
      version: -1
    taskid: dd0c5492-673d-4933-8f7a-080f6bb0462f
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 225
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "18"
    note: false
    quietmode: 0
    scriptarguments:
      earliest_time:
        simple: -24h
      execution-timeout:
        simple: "900"
      query:
        simple: "index=corp_security_zscaler appname=\"OneDrive (Personal)\" NOT dlpengine=\"None\"
          dlpengine=\"DLP*\" \n| stats count(dlpidentifier) as Total_Events by action
          \n| eval result=action+\": \"+Total_Events \n| stats values(result) as result"
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 3ac976da-7e27-4c71-8ae6-0193a0889ece
      iscommand: false
      name: Splunk query for zscaler policy engine (total volume)
      script: pp_splunk_search_v2
      type: regular
      version: -1
    taskid: 3ac976da-7e27-4c71-8ae6-0193a0889ece
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1565
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 66ac8ec1-31d9-4f82-84c0-a6e1720bca03
      iscommand: false
      name: Zscaler DLP policies total volume
      type: title
      version: -1
    taskid: 66ac8ec1-31d9-4f82-84c0-a6e1720bca03
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 575
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "1"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5ad3d831-969e-4980-8531-556e921b9115
      iscommand: false
      name: Zscaler volume by DLP policy
      type: title
      version: -1
    taskid: 5ad3d831-969e-4980-8531-556e921b9115
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1245
        }
      }
  "15":
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fc6f0560-0499-42aa-8ea6-2c26f81939a4
      iscommand: false
      name: OneDrive Personal traffic volume
      type: title
      version: -1
    taskid: fc6f0560-0499-42aa-8ea6-2c26f81939a4
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1405
        }
      }
  "16":
    continueonerrortype: ""
    id: "16"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: a873fdee-a9c7-4323-8e83-0d9db5871216
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: a873fdee-a9c7-4323-8e83-0d9db5871216
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1070
        }
      }
  "17":
    continueonerrortype: ""
    id: "17"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: Splunk
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Delete field from context
      id: ebdc9deb-4c5c-4d68-8a0e-602c51ccfc12
      iscommand: false
      name: Delete Splunk context
      script: DeleteContext
      type: regular
      version: -1
    taskid: ebdc9deb-4c5c-4d68-8a0e-602c51ccfc12
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 265,
          "y": 2265
        }
      }
  "18":
    continueonerrortype: ""
    id: "18"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "22"
    note: false
    quietmode: 0
    scriptarguments:
      key:
        simple: slack_message
      stringify:
        simple: "true"
      value:
        simple: ${Splunk.Result.result}
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 389fb3fc-1426-4a7d-8c8b-997612ecfbe8
      iscommand: false
      name: Move splunk results to slack_message context data
      script: Set
      type: regular
      version: -1
    taskid: 389fb3fc-1426-4a7d-8c8b-997612ecfbe8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1740
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    scriptarguments:
      name:
        simple: test_20211202_1
      type:
        simple: private
      users:
        simple: CDC Bot, lihlim
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Creates a channel in Slack.
      id: 35e83c9a-3a85-4692-82ce-419874ebc9cc
      iscommand: true
      name: Create channel
      script: SlackV2|||slack-create-channel
      type: regular
      version: -1
    taskid: 35e83c9a-3a85-4692-82ce-419874ebc9cc
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 910,
          "y": 50
        }
      }
  "21":
    continueonerrortype: ""
    id: "21"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "17"
    note: false
    quietmode: 0
    scriptarguments:
      channel:
        simple: ${slack_channel_name}
      message:
        simple: |-
          ===OneDrive Personal traffic volume===
          ${slack_message}
    separatecontext: false
    skipunavailable: false
    task:
      brand: SlackV2
      description: Sends a message to a user, group, or channel.
      id: 0f9737f4-9472-40dd-8d51-af949f1866f4
      iscommand: true
      name: Send splunk results to slack
      script: SlackV2|||send-notification
      type: regular
      version: -1
    taskid: 0f9737f4-9472-40dd-8d51-af949f1866f4
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 2090
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "21"
    note: false
    quietmode: 0
    scriptarguments:
      append:
        simple: "false"
      key:
        simple: slack_message
      value:
        complex:
          root: ${slack_message}
          transformers:
          - args:
              regex:
                value:
                  simple: \["
              replaceWith: {}
            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '","'
              replaceWith:
                value:
                  simple: |2+

            operator: replaceMatch
          - args:
              regex:
                value:
                  simple: '"\]'
              replaceWith: {}
            operator: replaceMatch
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Set a value in context under the key you entered.
      id: 68e22670-b332-4bde-82dd-9da0bbad149c
      iscommand: false
      name: Replace characters in slack_message
      script: Set
      type: regular
      version: -1
    taskid: 68e22670-b332-4bde-82dd-9da0bbad149c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 1915
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2485,
        "width": 1240,
        "x": 50,
        "y": 50
      }
    }
  }
