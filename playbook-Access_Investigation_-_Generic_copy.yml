contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    itemVersion: 1.2.2
    packID: ""
    packName: Access Investigation
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: |-
  This playbook investigates an access incident by gathering user and IP information.

  The playbook then interacts with the user that triggered the incident to confirm whether or not they initiated the access action.
id: e5a10ca8-54b7-403b-867b-90092ee1399f
inputs:
- description: The source IP address from which the incident originated.
  key: SrcIP
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: src
      root: incident
- description: The target IP address that was accessed.
  key: DstIP
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: dest
      root: incident
- description: The username of the account that was used to access the DstIP.
  key: Username
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: srcuser
      root: incident
- description: The default role to assign the incident to.
  key: Role
  playbookInputQuery: null
  required: true
  value:
    simple: Administrator
- description: Set to true to assign only the users that are currently on shift. Requires
    Cortex XSOAR v5.5 or later.
  key: OnCall
  playbookInputQuery: null
  required: false
  value:
    simple: "false"
name: Access Investigation - Generic_copy
outputs:
- contextPath: Account.Email.Address
  description: The email address object associated with the Account
  type: string
- contextPath: DBotScore
  description: Indicator, Score, Type, Vendor
  type: unknown
- contextPath: Account.ID
  description: The unique Account DN (Distinguished Name)
  type: string
- contextPath: Account.Username
  description: The Account username
  type: string
- contextPath: Account.Email
  description: The email address associated with the Account
- contextPath: Account.Type
  description: Type of the Account entity
  type: string
- contextPath: Account.Groups
  description: The groups the Account is part of
- contextPath: Account
  description: Account object
  type: unknown
- contextPath: Account.DisplayName
  description: The Account display name
  type: string
- contextPath: Account.Manager
  description: The Account's manager
  type: string
- contextPath: DBotScore.Indicator
  description: The indicator value
  type: string
- contextPath: DBotScore.Type
  description: The indicator's type
  type: string
- contextPath: DBotScore.Vendor
  description: The indicator's vendor
  type: string
- contextPath: DBotScore.Score
  description: The indicator's score
  type: number
- contextPath: IP
  description: The IP objects
  type: unknown
- contextPath: Endpoint
  description: The Endpoint's object
  type: unknown
- contextPath: Endpoint.Hostname
  description: The hostname to enrich
  type: string
- contextPath: Endpoint.OS
  description: Endpoint OS
  type: string
- contextPath: Endpoint.IP
  description: List of endpoint IP addresses
- contextPath: Endpoint.MAC
  description: List of endpoint MAC addresses
- contextPath: Endpoint.Domain
  description: Endpoint domain name
  type: string
rolename:
- Administrator
sourceplaybookid: access_investigation_-_generic
starttaskid: "0"
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "5"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 8d6a6188-3764-43a8-8dbf-4d1c4afdd305
      iscommand: false
      name: ""
      version: -1
    taskid: 8d6a6188-3764-43a8-8dbf-4d1c4afdd305
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 50
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fa4d5048-ddb4-4b37-821d-c02125988cb0
      iscommand: false
      name: Interact with the user
      type: title
      version: -1
    taskid: fa4d5048-ddb4-4b37-821d-c02125988cb0
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 597.5,
          "y": 890
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "9"
      - "10"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 32b53077-5a91-4580-892c-700d265fbc14
      iscommand: false
      name: Enrich indicators
      type: title
      version: -1
    taskid: 32b53077-5a91-4580-892c-700d265fbc14
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 195
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "31"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 22f48e10-7182-4ebd-83c5-39f423daee04
      iscommand: false
      name: Source & Destination IP Enrichment
      type: title
      version: -1
    taskid: 22f48e10-7182-4ebd-83c5-39f423daee04
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 880,
          "y": 340
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "29"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 9d6b7c59-ccb7-49f0-8553-d7dc78c0d4f1
      iscommand: false
      name: Source User Enrichment
      type: title
      version: -1
    taskid: 9d6b7c59-ccb7-49f0-8553-d7dc78c0d4f1
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 280,
          "y": 340
        }
      }
  "11":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: Email.Address
                filters:
                - - ignorecase: true
                    left:
                      iscontext: true
                      value:
                        simple: Account.Username
                    operator: isEqualString
                    right:
                      iscontext: true
                      value:
                        simple: inputs.Username
                root: Account
                transformers:
                - operator: uniq
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "12"
      "yes":
      - "13"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Verify that the source user account has an associated email address.
      id: d59bff22-6dbc-49ae-8bd6-8fe06856e0f9
      iscommand: false
      name: Does the source user account have an email address?
      type: condition
      version: -1
    taskid: d59bff22-6dbc-49ae-8bd6-8fe06856e0f9
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 597.5,
          "y": 1035
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6508ddaf-dc38-4966-899a-db88cba98da3
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: 6508ddaf-dc38-4966-899a-db88cba98da3
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 270,
          "y": 2400
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "14"
    note: false
    quietmode: 0
    scriptarguments:
      cc:
        complex:
          root: ManagerEmailAddress
      email:
        complex:
          accessor: Email.Address
          filters:
          - - ignorecase: true
              left:
                iscontext: true
                value:
                  simple: Account.Username
              operator: isEqualString
              right:
                iscontext: true
                value:
                  simple: inputs.Username
          root: Account
          transformers:
          - operator: uniq
      message:
        simple: "Hi ${incident.srcuser},\n\nWe identified unexpected activity on your
          account. \n\nStarting on ${incident.occurred}, there were suspicious log-in
          attempts from the ${incident.src} IP address.\n\nPlease confirm whether
          or not you recognize this activity.\nReply \"Yes\" to confirm this activity.
          \nReply \"No\" otherwise.\n\nRegards,\nYour friendly security team."
      option1:
        simple: "yes"
      option2:
        simple: "no"
      subject:
        simple: Unexpected account activity
      task:
        simple: AccessQ1
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Send an email to the source user email address to confirm whether
        they recognize the suspicious activity.
      id: 076ee903-0681-4d40-8c3b-10757c021db8
      iscommand: false
      name: Request user to confirm account activity
      script: EmailAskUser
      type: regular
      version: -1
    taskid: 076ee903-0681-4d40-8c3b-10757c021db8
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 710,
          "y": 1210
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "23"
      "yes":
      - "22"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Use the user response (yes or no) to direct the playbook.
      id: c357f8c3-d539-4448-83d3-9775e0e64238
      iscommand: false
      name: Get user response
      tags:
      - AccessQ1
      type: condition
      version: -1
    taskid: c357f8c3-d539-4448-83d3-9775e0e64238
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 710,
          "y": 1385
        }
      }
  "22":
    continueonerrortype: ""
    id: "22"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "24"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: d7367c83-59a1-4137-87d6-b35b679e116d
      iscommand: false
      name: User confirmed account activity
      type: title
      version: -1
    taskid: d7367c83-59a1-4137-87d6-b35b679e116d
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 495,
          "y": 1895
        }
      }
  "23":
    continueonerrortype: ""
    id: "23"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "26"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: fbdf64dc-6b83-4e2c-843b-004c97b5eb72
      iscommand: false
      name: User denied account activity
      type: title
      version: -1
    taskid: fbdf64dc-6b83-4e2c-843b-004c97b5eb72
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 925,
          "y": 1560
        }
      }
  "24":
    continueonerrortype: ""
    id: "24"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "25"
    note: false
    quietmode: 0
    scriptarguments:
      severity:
        simple: low
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Set the incident severity to low.
      id: 887a2bb0-edbd-4005-846d-f3f89b894daf
      iscommand: true
      name: Set severity to low
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: 887a2bb0-edbd-4005-846d-f3f89b894daf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 495,
          "y": 2055
        }
      }
  "25":
    continueonerrortype: ""
    id: "25"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    scriptarguments:
      closeReason:
        simple: 'User is the source of the suspicious activity '
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Close the investigation.
      id: 65c7329b-c159-406a-800b-c87fdb583f53
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: 65c7329b-c159-406a-800b-c87fdb583f53
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 710,
          "y": 2230
        }
      }
  "26":
    continueonerrortype: ""
    id: "26"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "27"
    note: false
    quietmode: 0
    scriptarguments:
      severity:
        simple: high
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Set the incident severity to high.
      id: f4c0eeb5-e511-4dfc-80df-1e62e94f634d
      iscommand: true
      name: Set severity to high
      script: Builtin|||setIncident
      type: regular
      version: -1
    taskid: f4c0eeb5-e511-4dfc-80df-1e62e94f634d
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 925,
          "y": 1705
        }
      }
  "27":
    continueonerrortype: ""
    id: "27"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "28"
    note: false
    quietmode: 0
    scriptarguments:
      onCall:
        complex:
          root: inputs.OnCall
      roles:
        complex:
          root: inputs.Role
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |
        Assign the incident to an analyst based on the analystâ€™s organizational role.
      id: a0f7a0a3-1414-4c54-878b-98105f9e22e5
      iscommand: false
      name: Assign to analyst
      script: AssignAnalystToIncident
      type: regular
      version: -1
    taskid: a0f7a0a3-1414-4c54-878b-98105f9e22e5
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 925,
          "y": 1880
        }
      }
  "28":
    continueonerrortype: ""
    id: "28"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "25"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: "Review the incident to determine if the account activity is malicious.\n\nIf
        malicious, consider the following:\n* Quarantine the account/ endpoint \n*
        Revoke the account password\n* Query the account/ IPs logs in the SIEM\n*
        Block the external IPs in the firewall/ proxy\n* Check the account's privileges
        and change if needed"
      id: 7c5a7854-d334-4fff-8f45-57ba7fd597fe
      iscommand: false
      name: Manually remediate  the incident
      type: regular
      version: -1
    taskid: 7c5a7854-d334-4fff-8f45-57ba7fd597fe
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 925,
          "y": 2055
        }
      }
  "29":
    continueonerrortype: ""
    id: "29"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "30"
    note: false
    quietmode: 0
    scriptarguments:
      Username:
        complex:
          root: inputs.Username
          transformers:
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 627044b6-abba-45d0-86dd-5c2411cc807f
      iscommand: false
      name: Account Enrichment - Generic v2.1
      playbookId: Account Enrichment - Generic v2.1
      type: playbook
      version: -1
    taskid: 627044b6-abba-45d0-86dd-5c2411cc807f
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 280,
          "y": 485
        }
      }
  "30":
    continueonerrortype: ""
    id: "30"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      Username:
        complex:
          root: inputs.Username
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: Takes an email address or a username of a user account in Active
        Directory, and returns the email address of the user's manager.
      id: 4018b3e5-d272-492c-8f32-966213af264e
      iscommand: false
      name: Active Directory - Get User Manager Details
      playbookId: Active Directory - Get User Manager Details
      type: playbook
      version: -1
    taskid: 4018b3e5-d272-492c-8f32-966213af264e
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 280,
          "y": 660
        }
      }
  "31":
    continueonerrortype: ""
    id: "31"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      IP:
        complex:
          root: inputs.SrcIP
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: inputs.DstIP
            operator: append
          - operator: uniq
      ResolveIP:
        simple: "True"
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: e2b62959-d616-4505-8e16-5e32aef47336
      iscommand: false
      name: IP Enrichment - Generic v2
      playbookId: IP Enrichment - Generic v2
      type: playbook
      version: -1
    taskid: e2b62959-d616-4505-8e16-5e32aef47336
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 880,
          "y": 480
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 2415,
        "width": 1035,
        "x": 270,
        "y": 50
      }
    }
  }
